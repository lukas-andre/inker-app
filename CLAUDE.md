# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Inker Studio is a Flutter mobile application for iOS and Android that connects tattoo artists with customers. The app uses Clean Architecture with BLoC pattern for state management and Freezed for immutable models.

## Essential Commands

### Code Generation (Required after model/state changes)
```bash
make build          # Generate Freezed and JSON serializable code
make intl           # Generate localization files
make build-all      # Run both code generation and localization
```

### Development
```bash
flutter pub get     # Install dependencies
flutter analyze     # Run linting
flutter test        # Run unit/widget tests
make test-coverage  # Generate test coverage report
```

### Building
```bash
make build-ios      # Build iOS IPA with obfuscation
make build-android  # Build Android APK with obfuscation
```

### Testing
```bash
make test-specific test=<path> device=<id>  # Run specific integration test
make test-auth-ios                          # Run iOS authentication tests
make test-auth-android                      # Run Android authentication tests
```

## Architecture

The codebase follows Clean Architecture with three layers:

### 1. UI Layer (`lib/ui/`)
- Feature-based organization (artist/, customer/, quotation/)
- Pages contain screens, widgets contain reusable components
- Navigation through `AppRoutes.onGenerateRoute` in lib/ui/shared/navigation/app_routes.dart

### 2. Domain Layer (`lib/domain/`)
- BLoCs/Cubits for state management (all states are Freezed)
- Repository interfaces (abstract classes)
- Immutable models using Freezed annotations
- Service abstractions

### 3. Data Layer (`lib/data/`)
- API communication via `HttpClientService` singleton
- Repository implementations
- Local storage: SQLite for data, SharedPreferences for settings
- Firebase integrations (Auth, FCM, Analytics)

## Key Patterns

### State Management
- Use BLoC/Cubit pattern with Freezed states
- Events trigger state changes in BLoCs
- All states must be immutable (@freezed)

### API Communication
- All API calls go through `HttpClientService`
- Endpoints defined in `lib/constants/endpoints.dart`
- Models use `fromJson/toJson` generated by json_serializable

### Dependency Injection
```dart
// Provide repositories
RepositoryProvider<Repository>(
  create: (_) => RepositoryImpl(httpClient: HttpClientService()),
)

// Provide BLoCs
BlocProvider<SomeBloc>(
  create: (context) => SomeBloc(
    repository: context.read<Repository>(),
  ),
)
```
- lib/dependencies/dependencies.dart

### Model Generation
After creating/modifying models or states:
1. Add @freezed or @JsonSerializable annotations
2. Run `make build` to generate code
3. Import the generated .g.dart and .freezed.dart files

## Important Files

- `.env` - API URL configuration
- `lib/constants/endpoints.dart` - All API endpoints
- `lib/ui/shared/navigation/app_routes.dart` - Route definitions
- `lib/main.dart` - App initialization and provider setup

## Testing Approach

- Unit tests for BLoCs and repositories in `test/`
- Integration tests using Patrol in `integration_test/`
- Mock API responses using Mockito
- Test coverage reports with `make test-coverage`

## Localization

- Primary locale: Spanish (Chile)
- Translations in `lib/l10n/intl_*.arb` // NOT MODIFY THIS FILE IT'S TO EXPENSINVE
- Generate translations: `make intl`
- Access translations: `S.of(context).key`